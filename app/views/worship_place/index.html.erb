<div id="container-fluid">
  <style type="text/css">
#map { height: 400px;
  margin-left:auto;
  margin-right:auto;
  text-align:right;
  width: 70%;
  border: solid 1px;
}
#search_box {
  height : 400px;
  border: solid 1px;
}
#submit_button {
  text-align:right;
}
#infoWindow {
  text-align: left;
}
  </style>

  <p id="notice"><%= notice %></p>

  <h1>御朱印マップ</h1>

  <div class="row-fluid">
    <div id="search_box" class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
      <%= form_tag '/', method: :post do %>
        <% %w(寺 神社).each do |item| %>
          <label>
            <%= check_box_tag 'worship_form[types][]', item, @check_box_status[item] %>
            <%= item %>
          </label>
        <% end %>
        <div id=submit_button>
          <%= submit_tag('送信') %>
        </div>
      <% end %>
    </div>

    <div id="map" class="col-xs-9 col-sm-9 col-md-9 col-lg-9">
      <script type="text/javascript">
function attachMessage(marker, msg) {
  var infowindow = new google.maps.InfoWindow({
    content: msg,
    maxWidth: 500
  });
  google.maps.event.addListener(marker, 'mouseover', function(event) {
    infowindow.open(marker.getMap(), marker);
  });
  marker.addListener('mouseout', function() {
    infowindow.close();
  });
}

function initMap() {
  var map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 35.674722, lng: 139.739583},
    zoom: 10
  });
  <% @worship_places.each do |worship_place| %>
    <% if worship_place.is_temple %>
      var icon = 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
    <% else %>
      var icon = 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
    <% end %>
    var marker = new google.maps.Marker({
      position:  {lat: <%= worship_place.latitude %>, lng: <%= worship_place.longitude %>},
      map: map,
      icon: icon
    });
    var contentString = "<div id='infoWindow'>" +
      "名称: <%= worship_place.name %><br>" + 
      "住所: <%= worship_place.address %><br>" +
      "<%= output_worship_place_item worship_place, :rank  %><br>" +
      "<%= output_worship_place_item worship_place, :object %><br>" +
      "<%= output_worship_place_item worship_place, :sect %><br>" +
      "</div>"
    attachMessage(marker, contentString);
  <% end %>
}
      </script>
      <script
              src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBflv1wp3O6qIB9ZL3x88bWTjiOeZnI5Kw&callback=initMap"
              async defer></script>
    </div>
  </div>
  <table>
    <thead>
      <tr>
        <th>Place_ID</th>
        <th>Name</th>
        <th>is_temple</th>
        <th>address</th>
        <th>latitude</th>
        <th>longitude</th>
        <th colspan="6"></th>
      </tr>
    </thead>

    <tbody>
      <% @worship_places.each do |worship_place| %>
        <tr>
          <td><%= worship_place.place_id %></td>
          <td><%= worship_place.name %></td>
          <td><%= worship_place.is_temple %></td>
          <td><%= worship_place.address %></td>
          <td><%= worship_place.latitude %></td>
          <td><%= worship_place.longitude %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
